.. note::

    Hola, 춰bienvenido a la Comunidad de Entusiastas de SunFounder para Raspberry Pi, Arduino y ESP32 en Facebook! Sum칠rgete en el mundo de Raspberry Pi, Arduino y ESP32 junto a otros entusiastas.

    **쯇or qu칠 unirse?**

    - **Soporte Experto**: Resuelve problemas postventa y desaf칤os t칠cnicos con la ayuda de nuestra comunidad y equipo.
    - **Aprende y Comparte**: Intercambia consejos y tutoriales para mejorar tus habilidades.
    - **Avances Exclusivos**: Obt칠n acceso anticipado a anuncios de nuevos productos y adelantos exclusivos.
    - **Descuentos Especiales**: Disfruta de descuentos exclusivos en nuestros productos m치s recientes.
    - **Promociones Festivas y Sorteos**: Participa en sorteos y promociones festivas.

    游녤 쯃isto para explorar y crear con nosotros? Haz clic en [|link_sf_facebook|] y 칰nete hoy mismo.

LED Controlado por Wi-Fi (Punto de Acceso)
---------------------------------------------------

Este proyecto te permite controlar una luz LED a trav칠s de una interfaz web. La placa Arduino act칰a como un punto de acceso Wi-Fi, creando su propia red local a la que puedes conectarte con un navegador web. Una vez conectado, puedes navegar a la direcci칩n IP del dispositivo utilizando el navegador web, donde encontrar치s opciones para encender y apagar un LED (conectado al pin 13 de la placa). El proyecto proporciona retroalimentaci칩n en tiempo real sobre el estado del LED a trav칠s del Monitor Serial, lo que facilita la depuraci칩n y comprensi칩n del flujo de operaciones.

1. Sube el c칩digo
========================

Abre el archivo ``01-wifi_ap.ino`` en la ruta ``elite-explorer-kit-main\r4_new_feature\01-wifi_ap``, o copia este c칩digo en **Arduino IDE**.

.. note:: 
      El soporte Wi-Fi춽 est치 habilitado mediante la biblioteca ``WiFiS3`` incorporada que se incluye con el Arduino UNO R4 Core. Instalar el core autom치ticamente instala la biblioteca ``WiFiS3``.

Todav칤a necesitas crear o modificar ``arduino_secrets.h``, reemplazando ``SECRET_SSID`` y ``SECRET_PASS`` con el nombre y la contrase침a de tu punto de acceso Wi-Fi. El archivo deber칤a contener:

.. code:: arduino

    //arduino_secrets.h header file
    #define SECRET_SSID "yournetwork"
    #define SECRET_PASS "yourpassword"

.. raw:: html
    
   <iframe src=https://create.arduino.cc/editor/sunfounder01/8d0d28d2-2394-4eaa-b276-86a4f061badb/preview?embed style="height:510px;width:100%;margin:10px 0" frameborder=0></iframe>

.. raw:: html

   <video loop autoplay muted style = "max-width:100%">
      <source src="../_static/videos/new_feature_projects/wifi.mp4"  type="video/mp4">
      Your browser does not support the video tag.
   </video>

2. Explicaci칩n del c칩digo
==============================

#. Importaci칩n de Bibliotecas Necesarias

   Importaci칩n de la biblioteca ``WiFiS3`` para las funcionalidades Wi-Fi y ``arduino_secrets.h`` para datos sensibles como contrase침as.
  
   .. code-block:: arduino
   
     #include "WiFiS3.h"
     #include "arduino_secrets.h"

#. Configuraci칩n e Inicializaci칩n de Variables

   Definir SSID de Wi-Fi, contrase침a e 칤ndice de clave junto con el pin del LED y el estado del Wi-Fi.
  
   .. code-block:: arduino
   
     char ssid[] = SECRET_SSID;        
     char pass[] = SECRET_PASS;        
     int keyIndex = 0;
     int led =  LED_BUILTIN;
     int status = WL_IDLE_STATUS;
     WiFiServer server(80);

#. Funci칩n ``setup()``

   Inicializar la comunicaci칩n serial y configurar el m칩dulo Wi-Fi.
   
   .. code-block:: arduino
   
     void setup() {

       // ... c칩digo de configuraci칩n ...
       // Crear punto de acceso
       status = WiFi.beginAP(ssid, pass);
       // ... manejo de errores ...
       // iniciar el servidor web en el puerto 80
       server.begin();
     }

   Tambi칠n verificamos si la versi칩n del firmware del uno R4 wifi est치 actualizada. Si no es la 칰ltima versi칩n, se mostrar치 un aviso de actualizaci칩n. Puedes consultar :ref:`update_firmware` para la actualizaci칩n del firmware.

   .. code-block:: arduino

      ...
      String fv = WiFi.firmwareVersion();
      if (fv < WIFI_FIRMWARE_LATEST_VERSION) {
          Serial.println("Please upgrade the firmware");
      }
      ...

   Es posible que desees modificar el siguiente c칩digo para poder cambiar la IP predeterminada de Arduino.

   .. code-block:: arduino
      
      WiFi.config(IPAddress(192,48,56,2));
   

#. Funci칩n Principal ``loop()``

   La funci칩n ``loop()`` en el c칩digo Arduino realiza varias operaciones clave, espec칤ficamente:
   
   1. Verificar si un dispositivo se ha conectado o desconectado del punto de acceso.
   2. Escuchar a los clientes entrantes que hacen solicitudes HTTP.
   3. Leer los datos del cliente y ejecutar acciones basadas en esos datos, como encender o apagar un LED.
   
   Aqu칤, desglosamos la funci칩n ``loop()`` para hacer estos pasos m치s comprensibles.
   
   #. Verificaci칩n del Estado del Wi-Fi

      El c칩digo primero verifica si el estado del Wi-Fi ha cambiado. Si un dispositivo se ha conectado o desconectado, el monitor serial mostrar치 la informaci칩n en consecuencia.
   
      .. code-block:: arduino
   
        if (status != WiFi.status()) {
          status = WiFi.status();
          if (status == WL_AP_CONNECTED) {
            Serial.println("Device connected to AP");
          } else {
            Serial.println("Device disconnected from AP");
          }
        }
   
   #. Escuchar a los Clientes Entrantes

      ``WiFiClient client = server.available();`` espera a los clientes entrantes.
     
      .. code-block:: arduino
   
        WiFiClient client = server.available();
   
   #. Manejo de Solicitudes de Clientes

      Escuchar a los clientes entrantes y servirles la p치gina web HTML. Cuando un usuario hace clic en los enlaces "Haz clic aqu칤 para encender el LED" o "Haz clic aqu칤 para apagar el LED" en la p치gina web servida, se env칤a una solicitud HTTP GET al servidor Arduino. Espec칤ficamente, se acceder치 a las URL "http://tuDireccion/H" para encender el LED y "http://tuDireccion/L" para apagarlo.
  
      .. code-block:: arduino

        WiFiClient client = server.available();
        if (client) {
          // ...
          client.println("HTTP/1.1 200 OK");
          client.println("Content-type:text/html");
          client.println();
          client.print("<p style=\"font-size:7vw;\">Click <a href=\"/H\">here</a> turn the LED on<br></p>");
          client.print("<p style=\"font-size:7vw;\">Click <a href=\"/L\">here</a> turn the LED off<br></p>");
          // ...
        }
   
      El c칩digo de Arduino escucha estas solicitudes GET entrantes. Cuando detecta ``GET /H`` al final de una l칤nea de texto entrante (cabecera HTTP), establece el LED conectado al pin 13 en HIGH, encendi칠ndolo. De manera similar, si detecta ``GET /L``, establece el LED en LOW, apag치ndolo.
     
      .. code-block:: arduino
   
         while (client.connected()) {            // bucle mientras el cliente est칠 conectado
           delayMicroseconds(10);                // Esto es necesario para el Arduino Nano RP2040 Connect - de lo contrario, se ejecutar치 tan r치pido que SPI nunca ser치 atendido.
           if (client.available()) {             // si hay bytes para leer del cliente,
             char c = client.read();             // leer un byte, luego
             Serial.write(c);                    // imprimirlo en el monitor serial
             if (c == '\n') {                    // si el byte es un car치cter de nueva l칤nea
               ...
               }
               else {      // si obtuviste una nueva l칤nea, entonces limpia currentLine:
                 currentLine = "";
               }
             }
             else if (c != '\r') {    // si obtuviste algo que no sea un car치cter de retorno de carro,
               currentLine += c;      // a침치delo al final de currentLine
             }
     
             // Verificar si la solicitud del cliente fue "GET /H" o "GET /L":
             if (currentLine.endsWith("GET /H")) {
               digitalWrite(led, HIGH);               // GET /H enciende el LED
             }
             if (currentLine.endsWith("GET /L")) {
               digitalWrite(led, LOW);                // GET /L apaga el LED
             }
           }



**Referencia**

- |link_r4_wifi|
